- pipeline: "Test"
  on: "CLICK"
  refs:
  - "refs/heads/main"
  fail_on_prepare_env_warning: true
  resources: "X2LARGE"
  actions:
  - action: "rake test"
    type: "BUILD"
    docker_image_name: "library/ruby"
    docker_image_tag: "3.3.5"
    execute_commands:
    - "#!/bin/sh"
    - ""
    - "# Create the HTML file"
    - "echo \"<html><body><h1>This is a test file</h1></body></html>\" > ruby-test.html"
    - ""
    - "# Configure Git user"
    - "git config --global user.name \"buddy\""
    - "git config --global user.email \"buddy@example.com\"  # Use a valid email format"
    - ""
    - "# Add the new file to the staging area"
    - "git add ruby-test.html"
    - ""
    - "# Commit the changes"
    - "git commit -m \"This is an example\""
    - ""
    - "# Create a new branch"
    - "git checkout -b add-ruby-test-file"
    - ""
    - "# Push the new branch to the remote repository"
    - "git push origin add-ruby-test-file"
    - ""
    - "# Create a pull request using GitHub API"
    - "curl -X POST -H \"Authorization: token ${GITHUB_ACCESS_TOKEN}\" \\"
    - "-H \"Accept: application/vnd.github.v3+json\" \\"
    - "https://api.github.com/repos/your-github-username/your-repo-name/pulls \\"
    - "-d '{\"title\":\"Add ruby-test.html\",\"head\":\"add-ruby-test-file\",\"base\":\"main\",\"body\":\"This is an example.\"}'"
    setup_commands:
    - "#!/bin/sh"
    - ""
    - "# Create the HTML file"
    - "echo \"<html><body><h1>This is a test file</h1></body></html>\" > ruby-test.html"
    - ""
    - "# Configure Git user"
    - "git config --global user.name \"buddy\""
    - "git config --global user.email \"buddy@example.com\"  # Use a valid email format"
    - ""
    - "# Add the new file to the staging area"
    - "git add ruby-test.html"
    - ""
    - "# Commit the changes"
    - "git commit -m \"This is an example\""
    - ""
    - "# Create a new branch"
    - "git checkout -b add-ruby-test-file"
    - ""
    - "# Push the new branch to the remote repository"
    - "git push origin add-ruby-test-file"
    - ""
    - "# Create a pull request using GitHub API"
    - "curl -X POST -H \"Authorization: token ${GITHUB_ACCESS_TOKEN}\" \\"
    - "-H \"Accept: application/vnd.github.v3+json\" \\"
    - "https://api.github.com/repos/your-github-username/your-repo-name/pulls \\"
    - "-d '{\"title\":\"Add ruby-test.html\",\"head\":\"add-ruby-test-file\",\"base\":\"main\",\"body\":\"This is an example.\"}'"
    cached_dirs:
    - "/usr/local/bundle"
    ignore_errors: true
